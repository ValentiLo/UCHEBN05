# **–ü–ú05. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –Ω–∞ —ç—Ç–∞–ø–µ –æ–ø—ã—Ç–Ω–æ–π —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏**

## **1. –°—Ç—Ä–∞—Ç–µ–≥–∏—è –æ–ø—ã—Ç–Ω–æ–π —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞**

### **1.1. –ü–ª–∞–Ω –æ–ø—ã—Ç–Ω–æ–π —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏**

```yaml
# pilot_operation_plan.yml
pilot_operation:
  duration: "30 –¥–Ω–µ–π"
  scope:
    users: "100-500 —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"
    features: "–í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–∞"
    traffic: "–ò–º–∏—Ç–∞—Ü–∏—è —Ä–µ–∞–ª—å–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏"
  
  monitoring:
    - "–°–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (CPU, –ø–∞–º—è—Ç—å, –¥–∏—Å–∫)"
    - "–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"
    - "–û—à–∏–±–∫–∏ –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è"
    - "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å–µ—Å—Å–∏–∏"
    - "–ë–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏"

  feedback_channels:
    - "In-app feedback —Ñ–æ—Ä–º–∞"
    - "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞"
    - "User analytics"
    - "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ—Ç—á–µ—Ç—ã"
```

---

## **2. –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —Å–±–æ—Ä–∞ –æ—à–∏–±–æ–∫**

### **2.1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –¥–ª—è –æ–ø—ã—Ç–Ω–æ–π —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏**

```python
# config/settings/pilot.py
from .production import *

# –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –æ–ø—ã—Ç–Ω–æ–π —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏
DEBUG = False
PILOT_MODE = True

# –†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
LOGGING = {
    'version': 1,
    'disable_existing_loggers': False,
    'formatters': {
        'verbose': {
            'format': '{levelname} {asctime} {module} {process:d} {thread:d} {message}',
            'style': '{',
        },
        'simple': {
            'format': '{levelname} {message}',
            'style': '{',
        },
    },
    'handlers': {
        'file': {
            'level': 'INFO',
            'class': 'logging.handlers.RotatingFileHandler',
            'filename': '/var/log/ecommerce/pilot.log',
            'maxBytes': 10485760,  # 10MB
            'backupCount': 10,
            'formatter': 'verbose',
        },
        'error_file': {
            'level': 'ERROR',
            'class': 'logging.handlers.RotatingFileHandler',
            'filename': '/var/log/ecommerce/pilot_errors.log',
            'maxBytes': 10485760,
            'backupCount': 10,
            'formatter': 'verbose',
        },
        'console': {
            'level': 'DEBUG',
            'class': 'logging.StreamHandler',
            'formatter': 'simple',
        },
    },
    'loggers': {
        'django': {
            'handlers': ['file', 'console'],
            'level': 'INFO',
            'propagate': True,
        },
        'ecommerce': {
            'handlers': ['file', 'error_file', 'console'],
            'level': 'DEBUG',
            'propagate': False,
        },
        'performance': {
            'handlers': ['file'],
            'level': 'INFO',
            'propagate': False,
        },
    },
}

# Sentry –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫
import sentry_sdk
from sentry_sdk.integrations.django import DjangoIntegration
from sentry_sdk.integrations.celery import CeleryIntegration
from sentry_sdk.integrations.redis import RedisIntegration

sentry_sdk.init(
    dsn=os.getenv('SENTRY_DSN_PILOT'),
    integrations=[
        DjangoIntegration(),
        CeleryIntegration(),
        RedisIntegration(),
    ],
    traces_sample_rate=1.0,  # 100% —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–æ–∫ –¥–ª—è –ø–∏–ª–æ—Ç–∞
    profiles_sample_rate=1.0,
    send_default_pii=True,
    environment="pilot",
    debug=True,
)

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
DATADOG_CONFIG = {
    'api_key': os.getenv('DATADOG_API_KEY'),
    'app_key': os.getenv('DATADOG_APP_KEY'),
}

# –°–∏—Å—Ç–µ–º–∞ —Å–±–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —Ñ–∏–¥–±–µ–∫–∞
USER_FEEDBACK_ENABLED = True
```

### **2.2. –ú–æ–¥–µ–ª–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫ –∏ —Ñ–∏–¥–±–µ–∫–∞**

```python
# modules/feedback/models.py
from django.db import models
import uuid

class PilotErrorReport(models.Model):
    """–ú–æ–¥–µ–ª—å –¥–ª—è –æ—Ç—á–µ—Ç–æ–≤ –æ–± –æ—à–∏–±–∫–∞—Ö –≤ –ø–∏–ª–æ—Ç–Ω–æ–π —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏"""
    
    ERROR_CATEGORIES = [
        ('ui', '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å'),
        ('functionality', '–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å'),
        ('performance', '–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å'),
        ('security', '–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å'),
        ('integration', '–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è'),
        ('data', '–î–∞–Ω–Ω—ã–µ'),
        ('other', '–î—Ä—É–≥–æ–µ'),
    ]
    
    SEVERITY_LEVELS = [
        ('critical', '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è'),
        ('high', '–í—ã—Å–æ–∫–∞—è'),
        ('medium', '–°—Ä–µ–¥–Ω—è—è'),
        ('low', '–ù–∏–∑–∫–∞—è'),
    ]
    
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    title = models.CharField(max_length=200, verbose_name="–ó–∞–≥–æ–ª–æ–≤–æ–∫ –æ—à–∏–±–∫–∏")
    description = models.TextField(verbose_name="–û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏")
    steps_to_reproduce = models.TextField(blank=True, verbose_name="–®–∞–≥–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è")
    expected_behavior = models.TextField(verbose_name="–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ")
    actual_behavior = models.TextField(verbose_name="–§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ")
    
    # –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è
    category = models.CharField(max_length=20, choices=ERROR_CATEGORIES)
    severity = models.CharField(max_length=10, choices=SEVERITY_LEVELS)
    module = models.CharField(max_length=100, verbose_name="–ú–æ–¥—É–ª—å —Å–∏—Å—Ç–µ–º—ã")
    
    # –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    url = models.URLField(blank=True, verbose_name="URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã")
    user_agent = models.TextField(blank=True)
    browser = models.CharField(max_length=100, blank=True)
    operating_system = models.CharField(max_length=100, blank=True)
    
    # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    user = models.ForeignKey('auth.User', on_delete=models.SET_NULL, null=True, blank=True)
    user_email = models.EmailField(blank=True, verbose_name="Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
    
    # –°—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏
    STATUS_CHOICES = [
        ('new', '–ù–æ–≤–∞—è'),
        ('investigating', '–†–∞—Å—Å–ª–µ–¥—É–µ—Ç—Å—è'),
        ('confirmed', '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞'),
        ('in_progress', '–í —Ä–∞–±–æ—Ç–µ'),
        ('resolved', '–†–µ—à–µ–Ω–∞'),
        ('wont_fix', '–ù–µ –±—É–¥–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞'),
    ]
    
    status = models.CharField(max_length=15, choices=STATUS_CHOICES, default='new')
    assigned_to = models.ForeignKey('auth.User', on_delete=models.SET_NULL, 
                                  null=True, blank=True, related_name='assigned_errors')
    
    # –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    resolved_at = models.DateTimeField(null=True, blank=True)
    
    class Meta:
        db_table = 'pilot_error_reports'
        verbose_name = '–û—Ç—á–µ—Ç –æ–± –æ—à–∏–±–∫–µ'
        verbose_name_plural = '–û—Ç—á–µ—Ç—ã –æ–± –æ—à–∏–±–∫–∞—Ö'
        ordering = ['-created_at']

class ErrorComment(models.Model):
    """–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –æ—Ç—á–µ—Ç–∞–º –æ–± –æ—à–∏–±–∫–∞—Ö"""
    
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    error_report = models.ForeignKey(PilotErrorReport, on_delete=models.CASCADE, 
                                   related_name='comments')
    author = models.ForeignKey('auth.User', on_delete=models.CASCADE)
    content = models.TextField(verbose_name="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π")
    is_technical_note = models.BooleanField(default=False, 
                                          verbose_name="–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∑–∞–º–µ—Ç–∫–∞")
    
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    
    class Meta:
        db_table = 'error_comments'
        ordering = ['created_at']

class SystemMetric(models.Model):
    """–ú–µ—Ç—Ä–∏–∫–∏ —Å–∏—Å—Ç–µ–º—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞"""
    
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    metric_type = models.CharField(max_length=50, verbose_name="–¢–∏–ø –º–µ—Ç—Ä–∏–∫–∏")
    value = models.FloatField(verbose_name="–ó–Ω–∞—á–µ–Ω–∏–µ")
    unit = models.CharField(max_length=20, verbose_name="–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è")
    timestamp = models.DateTimeField(auto_now_add=True)
    
    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    metadata = models.JSONField(default=dict, blank=True)
    
    class Meta:
        db_table = 'system_metrics'
        indexes = [
            models.Index(fields=['metric_type', 'timestamp']),
        ]
```

### **2.3. Middleware –¥–ª—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –æ–ø—ã—Ç–Ω–æ–π —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏**

```python
# core/middleware/pilot_monitoring.py
import time
import logging
from django.db import connection
from django.utils.deprecation import MiddlewareMixin
from modules.feedback.models import SystemMetric

logger = logging.getLogger('ecommerce')

class PilotMonitoringMiddleware(MiddlewareMixin):
    """Middleware –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≤ —Ä–µ–∂–∏–º–µ –æ–ø—ã—Ç–Ω–æ–π —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏"""
    
    def process_request(self, request):
        request.start_time = time.time()
        request.queries_before = len(connection.queries)
        
        # –õ–æ–≥–∏—Ä—É–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–ø—Ä–æ—Å–µ
        if hasattr(request, 'user') and request.user.is_authenticated:
            logger.info(f"Pilot request: {request.method} {request.path} - User: {request.user.email}")
        else:
            logger.info(f"Pilot request: {request.method} {request.path} - Anonymous")
    
    def process_response(self, request, response):
        if hasattr(request, 'start_time'):
            duration = time.time() - request.start_time
            queries_after = len(connection.queries)
            queries_count = queries_after - getattr(request, 'queries_before', 0)
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
            try:
                SystemMetric.objects.create(
                    metric_type='request_duration',
                    value=duration,
                    unit='seconds',
                    metadata={
                        'path': request.path,
                        'method': request.method,
                        'status_code': response.status_code,
                        'queries_count': queries_count
                    }
                )
                
                # –õ–æ–≥–∏—Ä—É–µ–º –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
                if duration > 2.0:
                    logger.warning(
                        f"Slow request detected: {request.method} {request.path} "
                        f"took {duration:.2f}s with {queries_count} queries"
                    )
                
                # –õ–æ–≥–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å—ã —Å –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º SQL –∑–∞–ø—Ä–æ—Å–æ–≤
                if queries_count > 20:
                    logger.warning(
                        f"High query count: {request.method} {request.path} "
                        f"executed {queries_count} queries"
                    )
                    
            except Exception as e:
                logger.error(f"Failed to save system metrics: {str(e)}")
        
        return response
    
    def process_exception(self, request, exception):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –≤ —Ä–µ–∂–∏–º–µ –ø–∏–ª–æ—Ç–∞"""
        logger.error(
            f"Pilot exception: {request.method} {request.path}",
            exc_info=True,
            extra={
                'user': getattr(request.user, 'email', 'anonymous'),
                'user_agent': request.META.get('HTTP_USER_AGENT', ''),
            }
        )

class UserBehaviorMiddleware(MiddlewareMixin):
    """Middleware –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"""
    
    def process_response(self, request, response):
        # –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –∫–ª—é—á–µ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        if (response.status_code == 200 and 
            hasattr(request, 'user') and 
            request.user.is_authenticated):
            
            key_actions = [
                '/cart/add/',
                '/checkout/',
                '/orders/create/',
                '/products/search/',
            ]
            
            for action in key_actions:
                if action in request.path:
                    logger.info(
                        f"User action: {request.user.email} - {request.path}",
                        extra={'action': action}
                    )
                    break
        
        return response
```

---

## **3. –°–∏—Å—Ç–µ–º–∞ —Å–±–æ—Ä–∞ –∏ –∞–Ω–∞–ª–∏–∑–∞ –æ—à–∏–±–æ–∫**

### **3.1. –°–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–∫–∞–º–∏**

```python
# modules/feedback/services/error_tracking.py
import logging
from datetime import datetime, timedelta
from django.db.models import Count, Q
from django.core.mail import send_mail
from ..models import PilotErrorReport, SystemMetric

logger = logging.getLogger('ecommerce')

class ErrorTrackingService:
    """–°–µ—Ä–≤–∏—Å –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–∫–∞–º–∏"""
    
    @classmethod
    def create_error_report(cls, data, user=None):
        """–°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞ –æ–± –æ—à–∏–±–∫–µ"""
        
        error_report = PilotErrorReport.objects.create(
            title=data.get('title', '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'),
            description=data['description'],
            steps_to_reproduce=data.get('steps_to_reproduce', ''),
            expected_behavior=data.get('expected_behavior', ''),
            actual_behavior=data.get('actual_behavior', ''),
            category=data.get('category', 'other'),
            severity=data.get('severity', 'medium'),
            module=data.get('module', 'unknown'),
            url=data.get('url', ''),
            user_agent=data.get('user_agent', ''),
            browser=data.get('browser', ''),
            operating_system=data.get('operating_system', ''),
            user=user,
            user_email=data.get('user_email', ''),
        )
        
        # –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        cls._send_error_notification(error_report)
        
        logger.info(f"New error report created: {error_report.id}")
        return error_report
    
    @classmethod
    def _send_error_notification(cls, error_report):
        """–û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤–æ–π –æ—à–∏–±–∫–µ"""
        try:
            subject = f"üö® –ù–æ–≤–∞—è –æ—à–∏–±–∫–∞ –≤ –ø–∏–ª–æ—Ç–Ω–æ–π —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏: {error_report.title}"
            
            message = f"""
            –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –Ω–æ–≤–∞—è –æ—à–∏–±–∫–∞ –≤ —Å–∏—Å—Ç–µ–º–µ:
            
            –ó–∞–≥–æ–ª–æ–≤–æ–∫: {error_report.title}
            –ú–æ–¥—É–ª—å: {error_report.module}
            –ö–∞—Ç–µ–≥–æ—Ä–∏—è: {error_report.get_category_display()}
            –°–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å: {error_report.get_severity_display()}
            
            –û–ø–∏—Å–∞–Ω–∏–µ:
            {error_report.description}
            
            URL: {error_report.url}
            –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {error_report.user_email or '–ù–µ —É–∫–∞–∑–∞–Ω'}
            –í—Ä–µ–º—è: {error_report.created_at}
            
            –°—Å—ã–ª–∫–∞ –Ω–∞ –æ—à–∏–±–∫—É: https://admin.example.com/feedback/errors/{error_report.id}/
            """
            
            # –û—Ç–ø—Ä–∞–≤–∫–∞ email –∫–æ–º–∞–Ω–¥–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
            send_mail(
                subject=subject,
                message=message.strip(),
                from_email='noreply@example.com',
                recipient_list=['dev-team@example.com', 'qa-team@example.com'],
                fail_silently=True,
            )
            
        except Exception as e:
            logger.error(f"Failed to send error notification: {str(e)}")
    
    @classmethod
    def get_error_statistics(cls, days=7):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –æ—à–∏–±–∫–∞–º"""
        
        start_date = datetime.now() - timedelta(days=days)
        
        stats = {
            'total_errors': PilotErrorReport.objects.filter(
                created_at__gte=start_date
            ).count(),
            
            'by_category': PilotErrorReport.objects.filter(
                created_at__gte=start_date
            ).values('category').annotate(
                count=Count('id')
            ).order_by('-count'),
            
            'by_severity': PilotErrorReport.objects.filter(
                created_at__gte=start_date
            ).values('severity').annotate(
                count=Count('id')
            ).order_by('-count'),
            
            'by_status': PilotErrorReport.objects.filter(
                created_at__gte=start_date
            ).values('status').annotate(
                count=Count('id')
            ).order_by('-count'),
            
            'by_module': PilotErrorReport.objects.filter(
                created_at__gte=start_date
            ).values('module').annotate(
                count=Count('id')
            ).order_by('-count'),
            
            'unresolved_critical': PilotErrorReport.objects.filter(
                severity='critical',
                status__in=['new', 'investigating', 'confirmed', 'in_progress']
            ).count(),
        }
        
        return stats
    
    @classmethod
    def find_similar_errors(cls, error_report):
        """–ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –æ—à–∏–±–æ–∫"""
        
        similar_errors = PilotErrorReport.objects.filter(
            Q(title__icontains=error_report.title.split()[0]) |
            Q(description__icontains=error_report.description[:100]),
            created_at__gte=datetime.now() - timedelta(days=30)
        ).exclude(id=error_report.id)
        
        return similar_errors
    
    @classmethod
    def generate_daily_report(cls):
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞ –ø–æ –æ—à–∏–±–∫–∞–º"""
        
        yesterday = datetime.now() - timedelta(days=1)
        
        new_errors = PilotErrorReport.objects.filter(
            created_at__gte=yesterday
        ).count()
        
        resolved_errors = PilotErrorReport.objects.filter(
            status='resolved',
            resolved_at__gte=yesterday
        ).count()
        
        critical_errors = PilotErrorReport.objects.filter(
            severity='critical',
            status__in=['new', 'investigating', 'confirmed']
        ).count()
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        slow_requests = SystemMetric.objects.filter(
            metric_type='request_duration',
            value__gt=2.0,
            timestamp__gte=yesterday
        ).count()
        
        report = {
            'date': datetime.now().strftime('%Y-%m-%d'),
            'new_errors': new_errors,
            'resolved_errors': resolved_errors,
            'critical_errors': critical_errors,
            'slow_requests': slow_requests,
            'top_error_categories': cls.get_error_statistics(1)['by_category'][:5]
        }
        
        return report
```

### **3.2. API –¥–ª—è —Å–±–æ—Ä–∞ –æ—à–∏–±–æ–∫ –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤**

```python
# modules/feedback/api/views.py
from rest_framework import viewsets, status
from rest_framework.decorators import action
from rest_framework.response import Response
from django.utils.decorators import method_decorator
from django.views.decorators.csrf import csrf_exempt
from ..models import PilotErrorReport, ErrorComment
from ..services.error_tracking import ErrorTrackingService
from .serializers import ErrorReportSerializer, ErrorCommentSerializer

class ErrorReportViewSet(viewsets.ModelViewSet):
    """API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ—Ç—á–µ—Ç–∞–º–∏ –æ–± –æ—à–∏–±–∫–∞—Ö"""
    
    queryset = PilotErrorReport.objects.all()
    serializer_class = ErrorReportSerializer
    
    def create(self, request):
        """–°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞ –æ–± –æ—à–∏–±–∫–µ"""
        serializer = self.get_serializer(data=request.data)
        serializer.is_valid(raise_exception=True)
        
        user = request.user if request.user.is_authenticated else None
        
        error_report = ErrorTrackingService.create_error_report(
            serializer.validated_data,
            user=user
        )
        
        return Response(
            ErrorReportSerializer(error_report).data,
            status=status.HTTP_201_CREATED
        )
    
    @action(detail=True, methods=['post'])
    def add_comment(self, request, pk=None):
        """–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –∫ –æ—à–∏–±–∫–µ"""
        error_report = self.get_object()
        
        comment_serializer = ErrorCommentSerializer(data=request.data)
        comment_serializer.is_valid(raise_exception=True)
        
        comment = ErrorComment.objects.create(
            error_report=error_report,
            author=request.user,
            content=comment_serializer.validated_data['content'],
            is_technical_note=comment_serializer.validated_data.get('is_technical_note', False)
        )
        
        return Response(
            ErrorCommentSerializer(comment).data,
            status=status.HTTP_201_CREATED
        )
    
    @action(detail=False, methods=['get'])
    def statistics(self, request):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –æ—à–∏–±–∫–∞–º"""
        days = int(request.query_params.get('days', 7))
        
        stats = ErrorTrackingService.get_error_statistics(days)
        return Response(stats)
    
    @action(detail=False, methods=['get'])
    def daily_report(self, request):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞"""
        report = ErrorTrackingService.generate_daily_report()
        return Response(report)

# API endpoint –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (–±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏)
@method_decorator(csrf_exempt, name='dispatch')
class PublicErrorReportViewSet(viewsets.ViewSet):
    """–ü—É–±–ª–∏—á–Ω—ã–π API –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—à–∏–±–æ–∫"""
    
    def create(self, request):
        """–ü—É–±–ª–∏—á–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞ –æ–± –æ—à–∏–±–∫–µ"""
        serializer = ErrorReportSerializer(data=request.data)
        serializer.is_valid(raise_exception=True)
        
        error_report = ErrorTrackingService.create_error_report(
            serializer.validated_data
        )
        
        return Response(
            {'id': str(error_report.id), 'status': 'created'},
            status=status.HTTP_201_CREATED
        )
```

---

## **4. –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ production-like —Å—Ä–µ–¥–µ**

### **4.1. –°–∫—Ä–∏–ø—Ç—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**

```python
#!/usr/bin/env python3
# scripts/pilot_health_check.py
import requests
import json
import time
import smtplib
from datetime import datetime
from email.mime.text import MIMEText

class PilotHealthChecker:
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã –≤ —Ä–µ–∂–∏–º–µ –ø–∏–ª–æ—Ç–Ω–æ–π —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏"""
    
    def __init__(self, base_url):
        self.base_url = base_url
        self.results = []
    
    def run_full_health_check(self):
        """–ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è"""
        print(f"üè• Starting pilot health check for {self.base_url}")
        
        checks = [
            self.check_main_page,
            self.check_api_endpoints,
            self.check_database_connection,
            self.check_cache_connection,
            self.check_celery_workers,
            self.check_static_files,
            self.check_performance,
            self.check_error_rates,
        ]
        
        for check in checks:
            try:
                result = check()
                self.results.append(result)
                
                if result['status'] == 'FAIL':
                    print(f"‚ùå {check.__name__}: FAILED")
                    self._send_alert(result)
                else:
                    print(f"‚úÖ {check.__name__}: PASSED")
                    
            except Exception as e:
                error_result = {
                    'check': check.__name__,
                    'status': 'ERROR',
                    'error': str(e),
                    'timestamp': datetime.now().isoformat()
                }
                self.results.append(error_result)
                print(f"üí• {check.__name__}: ERROR - {str(e)}")
        
        self.generate_health_report()
        return self.results
    
    def check_api_endpoints(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö API endpoints"""
        endpoints = [
            '/api/products/',
            '/api/categories/',
            '/api/auth/login/',
            '/api/health/',
            '/api/orders/',
        ]
        
        results = {}
        for endpoint in endpoints:
            try:
                start_time = time.time()
                response = requests.get(f"{self.base_url}{endpoint}", timeout=10)
                response_time = time.time() - start_time
                
                results[endpoint] = {
                    'status_code': response.status_code,
                    'response_time': response_time,
                    'success': response.status_code == 200
                }
                
                if response_time > 2.0:
                    results[endpoint]['warning'] = 'Slow response'
                    
            except Exception as e:
                results[endpoint] = {
                    'status_code': 0,
                    'error': str(e),
                    'success': False
                }
        
        failed_endpoints = [ep for ep, res in results.items() if not res['success']]
        
        return {
            'check': 'api_endpoints',
            'status': 'FAIL' if failed_endpoints else 'PASS',
            'details': results,
            'failed_endpoints': failed_endpoints,
            'timestamp': datetime.now().isoformat()
        }
    
    def check_performance(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"""
        performance_checks = {}
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        start_time = time.time()
        response = requests.get(self.base_url, timeout=10)
        page_load_time = time.time() - start_time
        
        performance_checks['page_load'] = {
            'time': page_load_time,
            'acceptable': page_load_time < 3.0
        }
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–ª–æ–∂–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
        start_time = time.time()
        response = requests.get(f"{self.base_url}/api/products/?search=test", timeout=10)
        search_time = time.time() - start_time
        
        performance_checks['search_query'] = {
            'time': search_time,
            'acceptable': search_time < 2.0
        }
        
        # –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        slow_operations = [op for op, res in performance_checks.items() if not res['acceptable']]
        
        return {
            'check': 'performance',
            'status': 'FAIL' if slow_operations else 'PASS',
            'details': performance_checks,
            'slow_operations': slow_operations,
            'timestamp': datetime.now().isoformat()
        }
    
    def check_error_rates(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Ä–æ–≤–Ω—è –æ—à–∏–±–æ–∫"""
        try:
            # –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –æ—à–∏–±–æ–∫ –∏–∑ API
            response = requests.get(f"{self.base_url}/api/feedback/errors/statistics/?days=1")
            
            if response.status_code == 200:
                stats = response.json()
                
                critical_errors = stats.get('unresolved_critical', 0)
                total_errors = stats.get('total_errors', 0)
                
                return {
                    'check': 'error_rates',
                    'status': 'FAIL' if critical_errors > 0 else 'PASS',
                    'details': stats,
                    'critical_errors': critical_errors,
                    'total_errors': total_errors,
                    'timestamp': datetime.now().isoformat()
                }
                
        except Exception as e:
            return {
                'check': 'error_rates',
                'status': 'ERROR',
                'error': str(e),
                'timestamp': datetime.now().isoformat()
            }
    
    def _send_alert(self, check_result):
        """–û—Ç–ø—Ä–∞–≤–∫–∞ –æ–ø–æ–≤–µ—â–µ–Ω–∏—è –æ –ø—Ä–æ–±–ª–µ–º–µ"""
        try:
            subject = f"üö® Pilot Health Check Alert: {check_result['check']}"
            
            message = f"""
            –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ –≤ –ø–∏–ª–æ—Ç–Ω–æ–π —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏:
            
            –ü—Ä–æ–≤–µ—Ä–∫–∞: {check_result['check']}
            –°—Ç–∞—Ç—É—Å: {check_result['status']}
            –í—Ä–µ–º—è: {check_result['timestamp']}
            
            –î–µ—Ç–∞–ª–∏:
            {json.dumps(check_result.get('details', {}), indent=2, ensure_ascii=False)}
            
            –°—Å—ã–ª–∫–∞ –Ω–∞ —Å–∏—Å—Ç–µ–º—É: {self.base_url}
            """
            
            self._send_email(subject, message.strip())
            
        except Exception as e:
            print(f"Failed to send alert: {str(e)}")
    
    def generate_health_report(self):
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞ –æ –∑–¥–æ—Ä–æ–≤—å–µ —Å–∏—Å—Ç–µ–º—ã"""
        report = {
            'timestamp': datetime.now().isoformat(),
            'base_url': self.base_url,
            'total_checks': len(self.results),
            'passed_checks': sum(1 for r in self.results if r['status'] == 'PASS'),
            'failed_checks': sum(1 for r in self.results if r['status'] == 'FAIL'),
            'error_checks': sum(1 for r in self.results if r['status'] == 'ERROR'),
            'results': self.results
        }
        
        # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–∞
        with open(f'/var/log/ecommerce/health_report_{datetime.now().strftime("%Y%m%d_%H%M")}.json', 'w') as f:
            json.dump(report, f, indent=2, ensure_ascii=False)
        
        print(f"\nüìä Health Check Report:")
        print(f"‚úÖ Passed: {report['passed_checks']}")
        print(f"‚ùå Failed: {report['failed_checks']}")
        print(f"üí• Errors: {report['error_checks']}")
        
        return report

if __name__ == "__main__":
    checker = PilotHealthChecker("https://pilot.example.com")
    results = checker.run_full_health_check()
```

### **4.2. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤**

```python
# scripts/pilot_user_scenarios.py
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from selenium.common.exceptions import TimeoutException
import time
import json

class PilotUserScenarioTester:
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –≤ –ø–∏–ª–æ—Ç–Ω–æ–π —Å—Ä–µ–¥–µ"""
    
    def __init__(self, base_url):
        self.base_url = base_url
        self.setup_driver()
    
    def setup_driver(self):
        """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Selenium WebDriver"""
        options = webdriver.ChromeOptions()
        options.add_argument('--headless')
        options.add_argument('--no-sandbox')
        options.add_argument('--disable-dev-shm-usage')
        
        self.driver = webdriver.Chrome(options=options)
        self.driver.implicitly_wait(10)
    
    def test_complete_purchase_flow(self):
        """–¢–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –ø–æ–∫—É–ø–∫–∏"""
        scenario_steps = []
        
        try:
            # –®–∞–≥ 1: –û—Ç–∫—Ä—ã—Ç–∏–µ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            self.driver.get(self.base_url)
            WebDriverWait(self.driver, 10).until(
                EC.presence_of_element_located((By.TAG_NAME, "body"))
            )
            scenario_steps.append({"step": "homepage_load", "status": "success"})
            
            # –®–∞–≥ 2: –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–∞
            search_input = self.driver.find_element(By.CSS_SELECTOR, "input[type='search']")
            search_input.send_keys("test product")
            search_input.submit()
            
            WebDriverWait(self.driver, 10).until(
                EC.presence_of_element_located((By.CLASS_NAME, "product-card"))
            )
            scenario_steps.append({"step": "product_search", "status": "success"})
            
            # –®–∞–≥ 3: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω—É
            add_to_cart_buttons = self.driver.find_elements(By.CSS_SELECTOR, ".add-to-cart")
            if add_to_cart_buttons:
                add_to_cart_buttons[0].click()
                
                WebDriverWait(self.driver, 10).until(
                    EC.presence_of_element_located((By.CLASS_NAME, "cart-notification"))
                )
                scenario_steps.append({"step": "add_to_cart", "status": "success"})
            
            # –®–∞–≥ 4: –ü–µ—Ä–µ—Ö–æ–¥ –≤ –∫–æ—Ä–∑–∏–Ω—É
            cart_link = self.driver.find_element(By.CSS_SELECTOR, ".cart-link")
            cart_link.click()
            
            WebDriverWait(self.driver, 10).until(
                EC.presence_of_element_located((By.CLASS_NAME, "cart-items"))
            )
            scenario_steps.append({"step": "cart_page", "status": "success"})
            
            return {
                "scenario": "complete_purchase_flow",
                "status": "success",
                "steps": scenario_steps,
                "timestamp": time.time()
            }
            
        except TimeoutException as e:
            scenario_steps.append({
                "step": "timeout_error", 
                "status": "error",
                "error": str(e)
            })
            return {
                "scenario": "complete_purchase_flow",
                "status": "failed",
                "steps": scenario_steps,
                "error": "Timeout occurred",
                "timestamp": time.time()
            }
        
        except Exception as e:
            scenario_steps.append({
                "step": "unexpected_error",
                "status": "error", 
                "error": str(e)
            })
            return {
                "scenario": "complete_purchase_flow",
                "status": "failed",
                "steps": scenario_steps,
                "error": str(e),
                "timestamp": time.time()
            }
    
    def test_user_registration_flow(self):
        """–¢–µ—Å—Ç –ø–æ—Ç–æ–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
        # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏...
        pass
    
    def run_all_scenarios(self):
        """–ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤"""
        scenarios = [
            self.test_complete_purchase_flow,
            self.test_user_registration_flow,
        ]
        
        results = []
        for scenario in scenarios:
            result = scenario()
            results.append(result)
            
            if result['status'] == 'success':
                print(f"‚úÖ {result['scenario']}: PASSED")
            else:
                print(f"‚ùå {result['scenario']}: FAILED - {result.get('error', 'Unknown error')}")
        
        # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        with open('/var/log/ecommerce/user_scenarios.json', 'w') as f:
            json.dump(results, f, indent=2)
        
        return results
    
    def __del__(self):
        """–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –¥—Ä–∞–π–≤–µ—Ä–∞"""
        if hasattr(self, 'driver'):
            self.driver.quit()

if __name__ == "__main__":
    tester = PilotUserScenarioTester("https://pilot.example.com")
    results = tester.run_all_scenarios()
```

---

## **5. –°–∏—Å—Ç–µ–º–∞ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏ –∏ –¥–∞—à–±–æ—Ä–¥—ã**

### **5.1. –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –æ—Ç—á–µ—Ç–æ–≤ –¥–ª—è –æ–ø—ã—Ç–Ω–æ–π —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏**

```python
# scripts/pilot_report_generator.py
from datetime import datetime, timedelta
import json
import pandas as pd
import matplotlib.pyplot as plt
from modules.feedback.services.error_tracking import ErrorTrackingService

class PilotReportGenerator:
    """–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –æ—Ç—á–µ—Ç–æ–≤ –ø–æ –æ–ø—ã—Ç–Ω–æ–π —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏"""
    
    def generate_weekly_report(self):
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞"""
        
        report_data = {
            'period': 'weekly',
            'generated_at': datetime.now().isoformat(),
            'error_analysis': self._analyze_errors(),
            'performance_metrics': self._get_performance_metrics(),
            'user_feedback': self._get_user_feedback_summary(),
            'system_health': self._get_system_health_status(),
            'recommendations': self._generate_recommendations()
        }
        
        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–π
        self._generate_charts(report_data)
        
        # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–∞
        report_file = f"/var/log/ecommerce/pilot_weekly_report_{datetime.now().strftime('%Y%m%d')}.json"
        with open(report_file, 'w') as f:
            json.dump(report_data, f, indent=2, ensure_ascii=False)
        
        return report_data
    
    def _analyze_errors(self):
        """–ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫ –∑–∞ –ø–µ—Ä–∏–æ–¥"""
        
        error_stats = ErrorTrackingService.get_error_statistics(7)
        
        analysis = {
            'total_errors': error_stats['total_errors'],
            'error_trend': self._calculate_error_trend(),
            'top_issues': list(error_stats['by_category'])[:5],
            'critical_issues': error_stats['unresolved_critical'],
            'most_affected_modules': list(error_stats['by_module'])[:3]
        }
        
        return analysis
    
    def _get_performance_metrics(self):
        """–°–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"""
        
        # –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –∏–∑ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
        performance_data = {
            'average_response_time': self._get_avg_response_time(),
            'p95_response_time': self._get_p95_response_time(),
            'throughput': self._get_throughput(),
            'error_rate': self._get_error_rate(),
            'slow_queries': self._get_slow_queries_count()
        }
        
        return performance_data
    
    def _generate_recommendations(self):
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é"""
        
        recommendations = []
        
        error_stats = ErrorTrackingService.get_error_statistics(7)
        
        # –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ –æ—à–∏–±–æ–∫
        for category in error_stats['by_category']:
            if category['count'] > 10:  # –ü–æ—Ä–æ–≥ –¥–ª—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
                recommendations.append({
                    'type': 'high_priority_fix',
                    'module': category['category'],
                    'description': f'–í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –æ—à–∏–±–æ–∫ –≤ –º–æ–¥—É–ª–µ {category["category"]}',
                    'priority': 'high'
                })
        
        # –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        performance_data = self._get_performance_metrics()
        if performance_data['p95_response_time'] > 3.0:
            recommendations.append({
                'type': 'performance_optimization',
                'description': '–í—ã—Å–æ–∫–æ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –¥–ª—è 95% –∑–∞–ø—Ä–æ—Å–æ–≤',
                'priority': 'medium'
            })
        
        return recommendations
    
    def _generate_charts(self, report_data):
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ –¥–ª—è –æ—Ç—á–µ—Ç–∞"""
        
        # –ì—Ä–∞—Ñ–∏–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
        categories = [item['category'] for item in report_data['error_analysis']['top_issues']]
        counts = [item['count'] for item in report_data['error_analysis']['top_issues']]
        
        plt.figure(figsize=(10, 6))
        plt.bar(categories, counts)
        plt.title('–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º')
        plt.xticks(rotation=45)
        plt.tight_layout()
        plt.savefig('/var/log/ecommerce/error_categories.png')
        plt.close()
```

### **5.2. –î–∞—à–±–æ—Ä–¥ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –æ–ø—ã—Ç–Ω–æ–π —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏**

```python
# modules/feedback/views/dashboard.py
from django.views.generic import TemplateView
from django.utils import timezone
from django.db.models import Count, Q
from django.contrib.auth.mixins import LoginRequiredMixin
from ..models import PilotErrorReport, SystemMetric

class PilotDashboardView(LoginRequiredMixin, TemplateView):
    """–î–∞—à–±–æ—Ä–¥ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –æ–ø—ã—Ç–Ω–æ–π —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏"""
    
    template_name = 'feedback/pilot_dashboard.html'
    
    def get_context_data(self, **kwargs):
        context = super().get_context_data(**kwargs)
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫
        context['error_stats'] = self._get_error_statistics()
        
        # –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        context['performance_metrics'] = self._get_performance_metrics()
        
        # –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—à–∏–±–∫–∏
        context['recent_errors'] = PilotErrorReport.objects.filter(
            status__in=['new', 'investigating', 'confirmed']
        ).order_by('-created_at')[:10]
        
        # –¢—Ä–µ–Ω–¥—ã
        context['error_trend'] = self._get_error_trend()
        
        return context
    
    def _get_error_statistics(self):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –æ—à–∏–±–æ–∫"""
        
        today = timezone.now().date()
        week_ago = today - timezone.timedelta(days=7)
        
        stats = {
            'total_errors_week': PilotErrorReport.objects.filter(
                created_at__gte=week_ago
            ).count(),
            
            'critical_errors': PilotErrorReport.objects.filter(
                severity='critical',
                status__in=['new', 'investigating', 'confirmed']
            ).count(),
            
            'errors_by_status': PilotErrorReport.objects.filter(
                created_at__gte=week_ago
            ).values('status').annotate(
                count=Count('id')
            ),
            
            'top_modules': PilotErrorReport.objects.filter(
                created_at__gte=week_ago
            ).values('module').annotate(
                count=Count('id')
            ).order_by('-count')[:5]
        }
        
        return stats
```

---

## **6. –ü—Ä–æ—Ü–µ—Å—Å —Ñ–∏–∫—Å–∞—Ü–∏–∏ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫**

### **6.1. Workflow –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫**

```python
# modules/feedback/services/error_workflow.py
from django.core.mail import send_mail
from django.template.loader import render_to_string
from ..models import PilotErrorReport

class ErrorWorkflowService:
    """–°–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è workflow –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫"""
    
    @classmethod
    def assign_error(cls, error_report, assigned_to, comment=None):
        """–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ –Ω–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞"""
        
        error_report.assigned_to = assigned_to
        error_report.status = 'in_progress'
        error_report.save()
        
        if comment:
            error_report.comments.create(
                author=assigned_to,
                content=comment,
                is_technical_note=True
            )
        
        # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
        cls._send_assignment_notification(error_report, assigned_to)
        
        return error_report
    
    @classmethod
    def resolve_error(cls, error_report, resolved_by, solution_details):
        """–†–µ—à–µ–Ω–∏–µ –æ—à–∏–±–∫–∏"""
        
        error_report.status = 'resolved'
        error_report.resolved_at = timezone.now()
        error_report.assigned_to = resolved_by
        error_report.save()
        
        # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è —Å —Ä–µ—à–µ–Ω–∏–µ–º
        error_report.comments.create(
            author=resolved_by,
            content=f"–û—à–∏–±–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞:\n{solution_details}",
            is_technical_note=True
        )
        
        # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω email)
        if error_report.user_email:
            cls._send_resolution_notification(error_report)
        
        return error_report
    
    @classmethod
    def _send_assignment_notification(cls, error_report, assigned_to):
        """–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ –æ—à–∏–±–∫–∏"""
        
        subject = f"üîß –ù–∞ –≤–∞—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –æ—à–∏–±–∫–∞: {error_report.title}"
        
        message = render_to_string('feedback/email/error_assigned.txt', {
            'error_report': error_report,
            'assigned_to': assigned_to,
        })
        
        send_mail(
            subject=subject,
            message=message,
            from_email='noreply@example.com',
            recipient_list=[assigned_to.email],
            fail_silently=True,
        )
```

### **6.2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—è –≤–µ—Ä—Å–∏–π**

```python
# scripts/error_to_issue_integration.py
import requests
import json
from datetime import datetime

class GitHubIntegration:
    """–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å GitHub –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è issues –∏–∑ –æ—à–∏–±–æ–∫"""
    
    def __init__(self, token, repo):
        self.token = token
        self.repo = repo
        self.headers = {
            'Authorization': f'token {token}',
            'Accept': 'application/vnd.github.v3+json'
        }
    
    def create_issue_from_error(self, error_report):
        """–°–æ–∑–¥–∞–Ω–∏–µ GitHub issue –∏–∑ –æ—Ç—á–µ—Ç–∞ –æ–± –æ—à–∏–±–∫–µ"""
        
        issue_data = {
            'title': f"[PILOT] {error_report.title}",
            'body': self._format_issue_body(error_report),
            'labels': [
                'pilot',
                f'severity:{error_report.severity}',
                f'module:{error_report.module}',
                f'category:{error_report.category}'
            ],
            'assignees': self._get_assignees(error_report.module)
        }
        
        response = requests.post(
            f'https://api.github.com/repos/{self.repo}/issues',
            headers=self.headers,
            json=issue_data
        )
        
        if response.status_code == 201:
            issue_data = response.json()
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ issue –≤ –æ—à–∏–±–∫–µ
            error_report.metadata = {
                'github_issue_url': issue_data['html_url'],
                'github_issue_number': issue_data['number']
            }
            error_report.save()
            
            return issue_data
        else:
            raise Exception(f"Failed to create issue: {response.text}")
    
    def _format_issue_body(self, error_report):
        """–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–∞ issue"""
        
        return f"""
## –û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏

{error_report.description}

## –®–∞–≥–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è

{error_report.steps_to_reproduce or '–ù–µ —É–∫–∞–∑–∞–Ω—ã'}

## –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

{error_report.expected_behavior}

## –§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

{error_report.actual_behavior}

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- **–ú–æ–¥—É–ª—å**: {error_report.module}
- **–ö–∞—Ç–µ–≥–æ—Ä–∏—è**: {error_report.get_category_display()}
- **–°–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å**: {error_report.get_severity_display()}
- **URL**: {error_report.url or '–ù–µ —É–∫–∞–∑–∞–Ω'}
- **–ë—Ä–∞—É–∑–µ—Ä**: {error_report.browser or '–ù–µ —É–∫–∞–∑–∞–Ω'}
- **–û–°**: {error_report.operating_system or '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}

## –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

- **Email**: {error_report.user_email or '–ù–µ —É–∫–∞–∑–∞–Ω'}
- **ID –æ—Ç—á–µ—Ç–∞**: {error_report.id}

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

–û—à–∏–±–∫–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –≤ —Ä–µ–∂–∏–º–µ –æ–ø—ã—Ç–Ω–æ–π —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏.
"""
```

–î–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –≤ —É—Å–ª–æ–≤–∏—è—Ö –æ–ø—ã—Ç–Ω–æ–π —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏ —Å –ø–æ–ª–Ω—ã–º —Ü–∏–∫–ª–æ–º –≤—ã—è–≤–ª–µ–Ω–∏—è, —Ñ–∏–∫—Å–∞—Ü–∏–∏, –∞–Ω–∞–ª–∏–∑–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è.
