# **–ü–ú05. –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–∞**

## **1. –°—Ç—Ä–∞—Ç–µ–≥–∏—è –æ—Ç–ª–∞–¥–∫–∏ –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã**

### **1.1. –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏**

```yaml
# –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –æ—Ç–ª–∞–¥–∫–∏
backend_debugging: 
  - "Django Debug Toolbar"
  - "pdb/ipdb/pudb"
  - "django-extensions"
  - "sentry"
  - "loguru"

frontend_debugging:
  - "React Developer Tools"
  - "Redux DevTools"
  - "Chrome DevTools"
  - "React Error Boundary"

database_debugging:
  - "pgAdmin/PostgreSQL logs"
  - "Django ORM query logging"
  - "EXPLAIN ANALYZE"

performance_debugging:
  - "Django Silk"
  - "Chrome Performance Tab"
  - "Lighthouse"
  - "New Relic"
```

---

## **2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏**

### **2.1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Django –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**

```python
# settings/dev.py
import os
from .base import *

DEBUG = True

# Django Debug Toolbar
INSTALLED_APPS += [
    'debug_toolbar',
    'django_extensions',
    'silk',
]

MIDDLEWARE = [
    'silk.middleware.SilkyMiddleware',
    'debug_toolbar.middleware.DebugToolbarMiddleware',
] + MIDDLEWARE

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Debug Toolbar
INTERNAL_IPS = [
    '127.0.0.1',
    'localhost',
]

DEBUG_TOOLBAR_PANELS = [
    'debug_toolbar.panels.history.HistoryPanel',
    'debug_toolbar.panels.versions.VersionsPanel',
    'debug_toolbar.panels.timer.TimerPanel',
    'debug_toolbar.panels.settings.SettingsPanel',
    'debug_toolbar.panels.headers.HeadersPanel',
    'debug_toolbar.panels.request.RequestPanel',
    'debug_toolbar.panels.sql.SQLPanel',
    'debug_toolbar.panels.staticfiles.StaticFilesPanel',
    'debug_toolbar.panels.templates.TemplatesPanel',
    'debug_toolbar.panels.cache.CachePanel',
    'debug_toolbar.panels.signals.SignalsPanel',
    'debug_toolbar.panels.logging.LoggingPanel',
    'debug_toolbar.panels.redirects.RedirectsPanel',
]

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ SQL –∑–∞–ø—Ä–æ—Å–æ–≤
LOGGING = {
    'version': 1,
    'disable_existing_loggers': False,
    'handlers': {
        'console': {
            'level': 'DEBUG',
            'class': 'logging.StreamHandler',
        },
        'file': {
            'level': 'DEBUG',
            'class': 'logging.FileHandler',
            'filename': 'debug.log',
        },
    },
    'loggers': {
        'django.db.backends': {
            'level': 'DEBUG',
            'handlers': ['console'],
        },
        'ecommerce': {
            'level': 'DEBUG',
            'handlers': ['console', 'file'],
            'propagate': False,
        },
    },
}

# Silk –¥–ª—è –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è
SILKY_PYTHON_PROFILER = True
SILKY_META = True
```

### **2.2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è**

```python
# core/logging_config.py
import logging
from loguru import logger
import sys

def setup_logging():
    """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è"""
    
    # Intercept standard logging
    class InterceptHandler(logging.Handler):
        def emit(self, record):
            # Get corresponding Loguru level if it exists
            try:
                level = logger.level(record.levelname).name
            except ValueError:
                level = record.levelno
            
            # Find caller from where originated the logged message
            frame, depth = logging.currentframe(), 2
            while frame.f_code.co_filename == logging.__file__:
                frame = frame.f_back
                depth += 1
            
            logger.opt(depth=depth, exception=record.exc_info).log(
                level, record.getMessage()
            )
    
    # Setup Loguru
    logger.remove()
    logger.add(
        "logs/debug_{time:YYYY-MM-DD}.log",
        level="DEBUG",
        rotation="10 MB",
        retention="30 days",
        format="{time:YYYY-MM-DD HH:mm:ss} | {level} | {module}:{function}:{line} | {message}"
    )
    logger.add(
        sys.stderr,
        level="INFO",
        format="<green>{time:YYYY-MM-DD HH:mm:ss}</green> | <level>{level}</level> | <cyan>{module}</cyan>:<cyan>{function}</cyan>:<cyan>{line}</cyan> | <level>{message}</level>"
    )
    
    # Intercept standard logging
    logging.basicConfig(handlers=[InterceptHandler()], level=0)

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
setup_logging()
```

---

## **3. –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –æ—Ç–ª–∞–¥–∫–∏ backend**

### **3.1. –ö–∞—Å—Ç–æ–º–Ω—ã–µ middleware –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏**

```python
# core/middleware/debug_middleware.py
import time
import logging
from django.db import connection
from django.utils.deprecation import MiddlewareMixin

logger = logging.getLogger(__name__)

class QueryDebugMiddleware(MiddlewareMixin):
    """Middleware –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è SQL –∑–∞–ø—Ä–æ—Å–æ–≤"""
    
    def process_request(self, request):
        request.start_time = time.time()
        request.queries_before = len(connection.queries)
    
    def process_response(self, request, response):
        if hasattr(request, 'start_time'):
            duration = time.time() - request.start_time
            queries_after = len(connection.queries)
            queries_count = queries_after - getattr(request, 'queries_before', 0)
            
            if queries_count > 10:  # –õ–æ–≥–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
                logger.warning(
                    f"High query count: {queries_count} queries in {duration:.2f}s "
                    f"for {request.path}"
                )
            
            if duration > 2.0:  # –õ–æ–≥–∏—Ä—É–µ–º –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
                logger.error(
                    f"Slow request: {duration:.2f}s for {request.path} "
                    f"({queries_count} queries)"
                )
        
        return response

class RequestLogMiddleware(MiddlewareMixin):
    """Middleware –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤"""
    
    def process_request(self, request):
        logger.info(f"Request: {request.method} {request.path}")
    
    def process_response(self, request, response):
        logger.info(f"Response: {response.status_code} for {request.method} {request.path}")
        return response
```

### **3.2. –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏**

```python
# core/decorators.py
import time
import functools
from django.db import connection
from loguru import logger

def debug_queries(func):
    """–î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ SQL –∑–∞–ø—Ä–æ—Å–æ–≤"""
    @functools.wraps(func)
    def wrapper(*args, **kwargs):
        initial_queries = len(connection.queries)
        start_time = time.time()
        
        try:
            result = func(*args, **kwargs)
            return result
        finally:
            final_queries = len(connection.queries)
            query_count = final_queries - initial_queries
            duration = time.time() - start_time
            
            logger.debug(
                f"Function {func.__name__}: {query_count} queries in {duration:.4f}s"
            )
            
            if query_count > 5:
                logger.warning(
                    f"High query count in {func.__name__}: {query_count} queries"
                )
    
    return wrapper

def time_execution(func):
    """–î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è"""
    @functools.wraps(func)
    def wrapper(*args, **kwargs):
        start_time = time.time()
        
        try:
            result = func(*args, **kwargs)
            return result
        finally:
            duration = time.time() - start_time
            logger.debug(f"Function {func.__name__} executed in {duration:.4f}s")
            
            if duration > 1.0:
                logger.warning(f"Slow function {func.__name__}: {duration:.4f}s")
    
    return wrapper

def log_exceptions(func):
    """–î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–∫–ª—é—á–µ–Ω–∏–π"""
    @functools.wraps(func)
    def wrapper(*args, **kwargs):
        try:
            return func(*args, **kwargs)
        except Exception as e:
            logger.error(
                f"Exception in {func.__name__}: {str(e)}",
                exc_info=True
            )
            raise
    
    return wrapper
```

---

## **4. –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**

### **4.1. –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ SQL –∑–∞–ø—Ä–æ—Å–æ–≤**

```python
# modules/products/services/debug_services.py
from django.db import connection
from loguru import logger

class QueryDebugService:
    
    @staticmethod
    def analyze_slow_queries():
        """–ê–Ω–∞–ª–∏–∑ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö SQL –∑–∞–ø—Ä–æ—Å–æ–≤"""
        from django.db import connection
        
        slow_queries = []
        for query in connection.queries:
            if float(query['time']) > 0.1:  # –ó–∞–ø—Ä–æ—Å—ã –¥–æ–ª—å—à–µ 100ms
                slow_queries.append({
                    'sql': query['sql'],
                    'time': query['time'],
                    'explain': QueryDebugService._explain_query(query['sql'])
                })
        
        return slow_queries
    
    @staticmethod
    def _explain_query(sql):
        """EXPLAIN ANALYZE –¥–ª—è SQL –∑–∞–ø—Ä–æ—Å–∞"""
        try:
            with connection.cursor() as cursor:
                cursor.execute(f"EXPLAIN ANALYZE {sql}")
                return cursor.fetchall()
        except Exception as e:
            return f"Explain failed: {str(e)}"
    
    @staticmethod
    def find_n_plus_one_queries():
        """–ü–æ–∏—Å–∫ N+1 –ø—Ä–æ–±–ª–µ–º –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö"""
        from modules.products.models import Product, Category
        
        # –ü—Ä–∏–º–µ—Ä –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è N+1
        products = Product.objects.all()[:10]
        
        problem_queries = []
        for product in products:
            # –≠—Ç–æ—Ç –≤—ã–∑–æ–≤ –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å N+1 –ø—Ä–æ–±–ª–µ–º—É
            category_name = product.category.name  # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞
            
            if len(connection.queries) > 15:  # –ï—Å–ª–∏ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤
                problem_queries.append({
                    'product_id': product.id,
                    'queries_count': len(connection.queries)
                })
        
        return problem_queries

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ views
@debug_queries
@time_execution
def product_list_debug(request):
    """–û—Ç–ª–∞–¥–æ—á–Ω–∞—è view –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"""
    products = Product.objects.select_related('category').prefetch_related('images')[:20]
    
    # –ê–Ω–∞–ª–∏–∑ –∑–∞–ø—Ä–æ—Å–æ–≤
    slow_queries = QueryDebugService.analyze_slow_queries()
    n_plus_one = QueryDebugService.find_n_plus_one_queries()
    
    return JsonResponse({
        'slow_queries': slow_queries,
        'n_plus_one_problems': n_plus_one,
        'total_queries': len(connection.queries)
    })
```

### **4.2. –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏**

```python
# core/profiling/memory_profiler.py
import tracemalloc
import linecache
from loguru import logger

class MemoryProfiler:
    
    def __init__(self):
        tracemalloc.start()
    
    def snapshot_memory(self, label=""):
        """–°–æ–∑–¥–∞–Ω–∏–µ —Å–Ω–∏–º–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏"""
        snapshot = tracemalloc.take_snapshot()
        
        logger.info(f"Memory snapshot {label}:")
        for stat in snapshot.statistics('lineno')[:10]:
            logger.info(f"  {stat}")
        
        return snapshot
    
    def compare_snapshots(self, snapshot1, snapshot2):
        """–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–≤—É—Ö —Å–Ω–∏–º–∫–æ–≤ –ø–∞–º—è—Ç–∏"""
        differences = snapshot2.compare_to(snapshot1, 'lineno')
        
        logger.info("Memory differences:")
        for stat in differences[:10]:
            logger.info(f"  {stat}")
        
        return differences
    
    def find_memory_leaks(self):
        """–ü–æ–∏—Å–∫ —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏"""
        snapshot = tracemalloc.take_snapshot()
        
        logger.info("Top memory usage:")
        for stat in snapshot.statistics('lineno')[:5]:
            logger.info(f"  {stat}")
            
            # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥
            frame = stat.traceback[0]
            filename = frame.filename
            lineno = frame.lineno
            
            line = linecache.getline(filename, lineno).strip()
            if line:
                logger.info(f"    Code: {line}")

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
profiler = MemoryProfiler()

@time_execution
def memory_intensive_operation():
    snapshot1 = profiler.snapshot_memory("Before operation")
    
    # –û–ø–µ—Ä–∞—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–Ω–æ–≥–æ –ø–∞–º—è—Ç–∏
    large_list = [i for i in range(1000000)]
    
    snapshot2 = profiler.snapshot_memory("After operation")
    profiler.compare_snapshots(snapshot1, snapshot2)
```

---

## **5. –û—Ç–ª–∞–¥–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞**

### **5.1. React Error Boundary**

```tsx
// components/Debug/ErrorBoundary.tsx
import React from 'react';
import { logError } from '../../services/loggingService';

interface ErrorBoundaryState {
  hasError: boolean;
  error?: Error;
  errorInfo?: React.ErrorInfo;
}

export class ErrorBoundary extends React.Component<
  { children: React.ReactNode; fallback?: React.ReactNode },
  ErrorBoundaryState
> {
  constructor(props: any) {
    super(props);
    this.state = { hasError: false };
  }

  static getDerivedStateFromError(error: Error): ErrorBoundaryState {
    return { hasError: true, error };
  }

  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {
    this.setState({
      error,
      errorInfo
    });

    // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏
    logError('React Error Boundary', {
      error: error.message,
      stack: error.stack,
      componentStack: errorInfo.componentStack
    });

    // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Sentry (–µ—Å–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω)
    if ((window as any).Sentry) {
      (window as any).Sentry.captureException(error, { extra: errorInfo });
    }
  }

  render() {
    if (this.state.hasError) {
      if (this.props.fallback) {
        return this.props.fallback;
      }

      return (
        <div className="error-boundary">
          <h2>Something went wrong</h2>
          <details style={{ whiteSpace: 'pre-wrap' }}>
            {this.state.error && this.state.error.toString()}
            <br />
            {this.state.errorInfo?.componentStack}
          </details>
          <button 
            onClick={() => this.setState({ hasError: false })}
            className="retry-button"
          >
            Try Again
          </button>
        </div>
      );
    }

    return this.props.children;
  }
}

// –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
export const PerformanceDebugger: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const startTime = React.useRef(performance.now());
  const [renderTime, setRenderTime] = React.useState(0);

  React.useEffect(() => {
    const endTime = performance.now();
    const duration = endTime - startTime.current;
    setRenderTime(duration);

    if (duration > 100) { // –ï—Å–ª–∏ —Ä–µ–Ω–¥–µ—Ä –¥–æ–ª—å—à–µ 100ms
      console.warn(`Slow render detected: ${duration}ms`);
    }
  });

  return (
    <div className="performance-debugger">
      <div className="debug-info">
        Render time: {renderTime.toFixed(2)}ms
      </div>
      {children}
    </div>
  );
};
```

### **5.2. Redux Debug Middleware**

```typescript
// store/debugMiddleware.ts
import { Middleware } from '@reduxjs/toolkit';

export const debugMiddleware: Middleware = (store) => (next) => (action) => {
  const startTime = performance.now();
  
  console.group(`Redux Action: ${action.type}`);
  console.log('Payload:', action.payload);
  console.log('State before:', store.getState());
  
  const result = next(action);
  
  console.log('State after:', store.getState());
  console.log(`Action processed in: ${(performance.now() - startTime).toFixed(2)}ms`);
  console.groupEnd();
  
  return result;
};

export const crashReporter: Middleware = (store) => (next) => (action) => {
  try {
    return next(action);
  } catch (err) {
    console.error('Redux Error:', err);
    console.error('Action that caused error:', action);
    console.error('Current state:', store.getState());
    
    // –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—à–∏–±–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
    fetch('/api/log-error', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        type: 'redux_error',
        error: err.toString(),
        action,
        state: store.getState()
      })
    });
    
    throw err;
  }
};
```

### **5.3. –•—É–∫–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏**

```typescript
// hooks/useDebug.ts
import { useEffect, useRef } from 'react';

export const useWhyDidYouUpdate = (name: string, props: any) => {
  const previousProps = useRef<any>();

  useEffect(() => {
    if (previousProps.current) {
      const allKeys = Object.keys({ ...previousProps.current, ...props });
      const changes: any = {};

      allKeys.forEach(key => {
        if (previousProps.current[key] !== props[key]) {
          changes[key] = {
            from: previousProps.current[key],
            to: props[key]
          };
        }
      });

      if (Object.keys(changes).length > 0) {
        console.log('[why-did-you-update]', name, changes);
      }
    }

    previousProps.current = props;
  });
};

export const useRenderCount = (componentName: string) => {
  const renderCount = useRef(0);
  
  renderCount.current += 1;
  
  useEffect(() => {
    console.log(`[render-count] ${componentName} rendered ${renderCount.current} times`);
    
    if (renderCount.current > 10) {
      console.warn(`[render-count] ${componentName} is rendering too frequently!`);
    }
  });
  
  return renderCount.current;
};
```

---

## **6. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Sentry –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –æ—à–∏–±–æ–∫**

### **6.1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Sentry**

```python
# core/sentry_config.py
import sentry_sdk
from sentry_sdk.integrations.django import DjangoIntegration
from sentry_sdk.integrations.redis import RedisIntegration
from sentry_sdk.integrations.celery import CeleryIntegration

def init_sentry():
    """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Sentry –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –æ—à–∏–±–æ–∫"""
    sentry_sdk.init(
        dsn=os.getenv('SENTRY_DSN'),
        integrations=[
            DjangoIntegration(),
            RedisIntegration(),
            CeleryIntegration(),
        ],
        # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏
        traces_sample_rate=0.1,  # 10% —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–æ–∫ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        profiles_sample_rate=0.1, # 10% –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–π
        
        # –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
        send_default_pii=True,  # –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        environment=os.getenv('ENVIRONMENT', 'development'),
        
        # –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –æ—à–∏–±–æ–∫
        before_send=before_send_filter,
        before_breadcrumb=before_breadcrumb_filter,
    )

def before_send_filter(event, hint):
    """–§–∏–ª—å—Ç—Ä –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–±—ã—Ç–∏–π –≤ Sentry"""
    # –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫
    if 'exc_info' in hint:
        exc_type, exc_value, tb = hint['exc_info']
        if isinstance(exc_value, SomeSpecificError):
            return None  # –ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —ç—Ç—É –æ—à–∏–±–∫—É
    
    # –î–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
    event.setdefault('tags', {}).update({
        'debug_mode': str(DEBUG),
    })
    
    return event

def before_breadcrumb_filter(crumb, hint):
    """–§–∏–ª—å—Ç—Ä –¥–ª—è —Ö–ª–µ–±–Ω—ã—Ö –∫—Ä–æ—à–µ–∫"""
    # –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –∫—Ä–æ—à–∫–∏
    if crumb.get('category') == 'console':
        return None
    
    return crumb
```

---

## **7. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏**

### **7.1. –¢–µ—Å—Ç—ã –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø—Ä–æ–±–ª–µ–º**

```python
# tests/debug_tests.py
import pytest
from django.test import TestCase
from django.db import connection
from core.decorators import debug_queries

class DebugTests(TestCase):
    
    def test_n_plus_one_queries(self):
        """–¢–µ—Å—Ç –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è N+1 –ø—Ä–æ–±–ª–µ–º"""
        from modules.products.models import Product, Category
        
        # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        category = Category.objects.create(name="Test Category")
        for i in range(5):
            Product.objects.create(
                name=f"Product {i}",
                price=100,
                category=category
            )
        
        # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ N+1
        with self.assertNumQueries(2):  # –û–∂–∏–¥–∞–µ–º —Ç–æ–ª—å–∫–æ 2 –∑–∞–ø—Ä–æ—Å–∞
            products = Product.objects.select_related('category').all()
            for product in products:
                category_name = product.category.name  # –ù–µ –¥–æ–ª–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
    
    def test_slow_query_detection(self):
        """–¢–µ—Å—Ç –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤"""
        from modules.products.services.search_service import ProductSearchService
        
        start_time = time.time()
        
        # –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –º–µ–¥–ª–µ–Ω–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
        results = ProductSearchService.search_products(
            query="test",
            sort_by="relevance"
        )
        
        duration = time.time() - start_time
        self.assertLess(duration, 1.0, "Query took too long")
    
    def test_memory_usage(self):
        """–¢–µ—Å—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏"""
        import tracemalloc
        
        tracemalloc.start()
        
        snapshot1 = tracemalloc.take_snapshot()
        
        # –û–ø–µ—Ä–∞—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–Ω–æ–≥–æ –ø–∞–º—è—Ç–∏
        large_list = [i for i in range(100000)]
        
        snapshot2 = tracemalloc.take_snapshot()
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –ø–∞–º—è—Ç—å –Ω–µ —É—Ç–µ–∫–∞–µ—Ç
        memory_diff = snapshot2.compare_to(snapshot1, 'lineno')
        total_memory_increase = sum(stat.size for stat in memory_diff)
        
        self.assertLess(total_memory_increase, 1024 * 1024, "Memory leak detected")  # 1MB

@pytest.mark.debug
def test_concurrent_requests():
    """–¢–µ—Å—Ç –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –ø–æ–∏—Å–∫–∞ race conditions"""
    import threading
    from django.test import Client
    
    client = Client()
    results = []
    errors = []
    
    def make_request():
        try:
            response = client.get('/api/products/')
            results.append(response.status_code)
        except Exception as e:
            errors.append(str(e))
    
    # –°–æ–∑–¥–∞–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ—Ç–æ–∫–æ–≤
    threads = []
    for i in range(10):
        thread = threading.Thread(target=make_request)
        threads.append(thread)
        thread.start()
    
    # –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
    for thread in threads:
        thread.join()
    
    assert not errors, f"Concurrent requests failed: {errors}"
    assert all(code == 200 for code in results), "Not all requests succeeded"
```

---

## **8. –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç–ª–∞–¥–∫–∏**

### **8.1. –°–∫—Ä–∏–ø—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ —Å–∏—Å—Ç–µ–º—ã**

```python
# scripts/system_diagnostic.py
#!/usr/bin/env python
import os
import sys
import django
import logging
from datetime import datetime

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Django
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'core.settings.dev')
django.setup()

from django.db import connection
from django.core.cache import cache
from loguru import logger

class SystemDiagnostic:
    """–ö–ª–∞—Å—Å –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ —Å–∏—Å—Ç–µ–º—ã"""
    
    def run_full_diagnostic(self):
        """–ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ —Å–∏—Å—Ç–µ–º—ã"""
        logger.info("Starting system diagnostic...")
        
        checks = [
            self.check_database_connection,
            self.check_cache_connection,
            self.check_migrations,
            self.check_static_files,
            self.check_celery_workers,
            self.check_redis_connection,
            self.check_disk_space,
            self.check_memory_usage,
        ]
        
        results = {}
        for check in checks:
            try:
                result = check()
                results[check.__name__] = result
                logger.info(f"‚úì {check.__name__}: {result['status']}")
            except Exception as e:
                results[check.__name__] = {'status': 'ERROR', 'error': str(e)}
                logger.error(f"‚úó {check.__name__}: {str(e)}")
        
        self.generate_report(results)
        return results
    
    def check_database_connection(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö"""
        try:
            with connection.cursor() as cursor:
                cursor.execute("SELECT 1")
                result = cursor.fetchone()
            
            return {
                'status': 'OK',
                'details': 'Database connection successful'
            }
        except Exception as e:
            return {
                'status': 'ERROR',
                'error': str(e)
            }
    
    def check_cache_connection(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∫—ç—à—É"""
        try:
            cache.set('diagnostic_test', 'test_value', 10)
            value = cache.get('diagnostic_test')
            
            if value == 'test_value':
                return {
                    'status': 'OK',
                    'details': 'Cache connection successful'
                }
            else:
                return {
                    'status': 'ERROR',
                    'error': 'Cache test failed'
                }
        except Exception as e:
            return {
                'status': 'ERROR',
                'error': str(e)
            }
    
    def check_migrations(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π"""
        from django.core.management import execute_from_command_line
        
        try:
            execute_from_command_line(['manage.py', 'migrate', '--check'])
            return {
                'status': 'OK',
                'details': 'All migrations applied'
            }
        except SystemExit:
            return {
                'status': 'WARNING',
                'details': 'Pending migrations found'
            }
    
    def generate_report(self, results):
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏"""
        report = {
            'timestamp': datetime.now().isoformat(),
            'results': results,
            'summary': {
                'total_checks': len(results),
                'passed_checks': sum(1 for r in results.values() if r['status'] == 'OK'),
                'failed_checks': sum(1 for r in results.values() if r['status'] == 'ERROR'),
                'warnings': sum(1 for r in results.values() if r['status'] == 'WARNING'),
            }
        }
        
        logger.info("Diagnostic report:")
        logger.info(f"Total checks: {report['summary']['total_checks']}")
        logger.info(f"Passed: {report['summary']['passed_checks']}")
        logger.info(f"Failed: {report['summary']['failed_checks']}")
        logger.info(f"Warnings: {report['summary']['warnings']}")
        
        # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–∞ –≤ —Ñ–∞–π–ª
        with open('diagnostic_report.json', 'w') as f:
            import json
            json.dump(report, f, indent=2)
        
        return report

if __name__ == '__main__':
    diagnostic = SystemDiagnostic()
    diagnostic.run_full_diagnostic()
```

### **8.2. –°–∫—Ä–∏–ø—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏**

```python
# scripts/live_monitor.py
#!/usr/bin/env python
import time
import psutil
import requests
from datetime import datetime
from loguru import logger

class LiveMonitor:
    """–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏"""
    
    def __init__(self, check_interval=5):
        self.check_interval = check_interval
        self.thresholds = {
            'cpu_percent': 80,
            'memory_percent': 85,
            'disk_percent': 90,
            'response_time': 2.0,
        }
    
    def start_monitoring(self):
        """–ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞"""
        logger.info("Starting live monitoring...")
        
        try:
            while True:
                self.check_system_health()
                self.check_application_health()
                time.sleep(self.check_interval)
        except KeyboardInterrupt:
            logger.info("Monitoring stopped")
    
    def check_system_health(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã"""
        # CPU
        cpu_percent = psutil.cpu_percent(interval=1)
        if cpu_percent > self.thresholds['cpu_percent']:
            logger.warning(f"High CPU usage: {cpu_percent}%")
        
        # Memory
        memory = psutil.virtual_memory()
        if memory.percent > self.thresholds['memory_percent']:
            logger.warning(f"High memory usage: {memory.percent}%")
        
        # Disk
        disk = psutil.disk_usage('/')
        if disk.percent > self.thresholds['disk_percent']:
            logger.warning(f"High disk usage: {disk.percent}%")
    
    def check_application_health(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"""
        try:
            start_time = time.time()
            response = requests.get('http://localhost:8000/health/', timeout=5)
            response_time = time.time() - start_time
            
            if response.status_code != 200:
                logger.error(f"Application health check failed: {response.status_code}")
            
            if response_time > self.thresholds['response_time']:
                logger.warning(f"Slow response time: {response_time:.2f}s")
            
            logger.info(f"App health: {response.status_code} in {response_time:.2f}s")
            
        except requests.exceptions.RequestException as e:
            logger.error(f"Application health check error: {str(e)}")

if __name__ == '__main__':
    monitor = LiveMonitor()
    monitor.start_monitoring()
```

---

## **9. –ß–µ–∫-–ª–∏—Å—Ç –æ—Ç–ª–∞–¥–∫–∏**

### **9.1. –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º**

```markdown
# –ß–µ–∫-–ª–∏—Å—Ç –æ—Ç–ª–∞–¥–∫–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–∞

## üêõ –û–±—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –æ—à–∏–±–æ–∫
- [ ] –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –ø—Ä–æ–±–ª–µ–º—É –≤ dev —Å—Ä–µ–¥–µ
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

## üóÑÔ∏è –ü—Ä–æ–±–ª–µ–º—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
- [ ] –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å N+1 –ø—Ä–æ–±–ª–µ–º—ã

## üé® –ü—Ä–æ–±–ª–µ–º—ã —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Network tab –≤ DevTools
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ Redux store
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–∞ re-renders

## ‚ö° –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞
- [ ] –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

## üîê –ü—Ä–æ–±–ª–µ–º—ã —Å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å CSRF —Ç–æ–∫–µ–Ω—ã
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é

## üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –æ—Ç–ª–∞–¥–∫–∏
1. Django Debug Toolbar - –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
2. React DevTools - –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
3. Redux DevTools - –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
4. Chrome DevTools - –¥–ª—è –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è
5. Sentry - –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –æ—à–∏–±–æ–∫
```

–î–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—Ç–ª–∞–¥–∫–∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

1. **–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** –æ—à–∏–±–æ–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
2. **–î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑** –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö
3. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É** —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º
4. **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã** –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–≥–æ–≤
5. **–ü—Ä–æ–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ** –ø—Ä–æ–±–ª–µ–º –¥–æ –∏—Ö –ø–æ—è–≤–ª–µ–Ω–∏—è –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
